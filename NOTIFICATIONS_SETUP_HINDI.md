# рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдФрд░ рдкреБрд╢ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕реЗрдЯрдЕрдк рдЧрд╛рдЗрдб

рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI School 360 рдореЗрдВ рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред

## ЁЯЪА рд▓рд╛рдЧреВ рдХреА рдЧрдИ рд╕реБрд╡рд┐рдзрд╛рдПрдБ

### 1. **рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдЕрдкрдбреЗрдЯ (рдмрд┐рдирд╛ рд░рд┐рдлреНрд░реЗрд╢ рдХреЗ)**
- тЬЕ рдЬрдм рдПрдбрдорд┐рди/рдЯреАрдЪрд░ рдиреЛрдЯрд┐рд╕ рдкреЛрд╕реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЕрдкрдиреЗ рдЖрдк рдЕрдкрдбреЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ
- тЬЕ рдЬрдм рдЯреАрдЪрд░ рд╣реЛрдорд╡рд░реНрдХ assign рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЕрдкрдиреЗ рдЖрдк рдЕрдкрдбреЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ
- тЬЕ рдореИрд╕реЗрдЬ рднреЗрдЬрдиреЗ рдкрд░ рдЕрдкрдиреЗ рдЖрдк рдЕрдкрдбреЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ
- тЬЕ рдирдП рдЕрдкрдбреЗрдЯ рдХреЗ рд▓рд┐рдП рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рд╛рдЙрдВрдб рдмрдЬрддрд╛ рд╣реИ
- тЬЕ рдирдП рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкрд░ "NEW" рдмреИрдЬ рджрд┐рдЦрддрд╛ рд╣реИ

### 2. **рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдкреБрд╢ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди**
- тЬЕ PWA рдРрдк рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ
- тЬЕ Firebase Cloud Messaging (FCM) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ
- тЬЕ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рджрд┐рдЦрд╛рддрд╛ рд╣реИ
- тЬЕ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рд╛рдЙрдВрдб рдмрдЬрд╛рддрд╛ рд╣реИ
- тЬЕ рдореЛрдмрд╛рдЗрд▓ рдкрд░ рд╡рд╛рдЗрдмреНрд░реЗрд╢рди рд╕рдкреЛрд░реНрдЯ

## ЁЯУЛ рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджреЗрд╢

### рд╕реНрдЯреЗрдк 1: Firebase Console рдореЗрдВ VAPID Key рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ

1. [Firebase Console](https://console.firebase.google.com/) рдкрд░ рдЬрд╛рдПрдВ
2. рдЕрдкрдирд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЪреБрдиреЗрдВ: **ai-school360**
3. **Settings (тЪЩя╕П)** > **Project settings** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
4. **Cloud Messaging** рдЯреИрдм рдкрд░ рдЬрд╛рдПрдВ
5. **Web Push certificates** рд╕реЗрдХреНрд╢рди рддрдХ рд╕реНрдХреНрд░реЙрд▓ рдХрд░реЗрдВ
6. **Generate key pair** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
7. рдЬрдирд░реЗрдЯ рдХреА рдЧрдИ key рдХреЛ рдХреЙрдкреА рдХрд░реЗрдВ

### рд╕реНрдЯреЗрдк 2: VAPID Key рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ

`src/lib/notifications.ts` рдЦреЛрд▓реЗрдВ рдФрд░ `YOUR_VAPID_KEY_HERE` рдХреЛ рдЕрдкрдиреА рдЕрд╕рд▓реА VAPID key рд╕реЗ рдмрджрд▓реЗрдВ:

```typescript
const VAPID_KEY = 'YOUR_ACTUAL_VAPID_KEY_FROM_FIREBASE';
```

### рд╕реНрдЯреЗрдк 3: Notification Sound рдЬреЛрдбрд╝реЗрдВ

1. рдПрдХ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рд╛рдЙрдВрдб рдбрд╛рдЙрдирд▓реЛрдб рдпрд╛ рдмрдирд╛рдПрдВ (`.mp3` рдлреЙрд░реНрдореЗрдЯ)
2. рдЗрд╕реЗ `public` рдлреЛрд▓реНрдбрд░ рдореЗрдВ `notification.mp3` рдХреЗ рд░реВрдк рдореЗрдВ рд░рдЦреЗрдВ
3. рд╕реБрдЭрд╛рд╡: рдЫреЛрдЯрд╛, рд╕реБрдЦрдж рд╕рд╛рдЙрдВрдб (1-2 рд╕реЗрдХрдВрдб)

**рдореБрдлреНрдд рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рд╛рдЙрдВрдб:**
- https://notificationsounds.com/
- https://mixkit.co/free-sound-effects/notification/

### рд╕реНрдЯреЗрдк 4: Service Worker Registration рдЪреЗрдХ рдХрд░реЗрдВ

рд╕рд░реНрд╡рд┐рд╕ рд╡рд░реНрдХрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА `public/firebase-messaging-sw.js` рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╣реИред

### рд╕реНрдЯреЗрдк 5: Notifications рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ

1. **Development server рд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВ:**
   ```bash
   npm run dev
   ```

2. **Parent Dashboard рдЦреЛрд▓реЗрдВ**
   - Parent рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВ
   - рдЖрдкрдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкрд░рдорд┐рд╢рди рдкреЙрдкрдЕрдк рджрд┐рдЦреЗрдЧрд╛
   - **Allow** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ

3. **Real-time updates рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ:**
   - рджреВрд╕рд░реА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ рдЦреЛрд▓реЗрдВ
   - Admin/Teacher рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВ
   - рдПрдХ рдиреЛрдЯрд┐рд╕ рдкреЛрд╕реНрдЯ рдХрд░реЗрдВ рдпрд╛ рд╣реЛрдорд╡рд░реНрдХ assign рдХрд░реЗрдВ
   - Parent dashboard рдЪреЗрдХ рдХрд░реЗрдВ - рдпрд╣ рд╕рд╛рдЙрдВрдб рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рдЖрдк рдЕрдкрдбреЗрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛!

4. **Background notifications рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ:**
   - Parent рдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЯреИрдм рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрдВрдж рдХрд░ рджреЗрдВ
   - Admin рдХреЗ рд░реВрдк рдореЗрдВ рдиреЛрдЯрд┐рд╕/рд╣реЛрдорд╡рд░реНрдХ рдкреЛрд╕реНрдЯ рдХрд░реЗрдВ
   - Parent рдХреЛ рдРрдк рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рднреА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдорд┐рд▓рдирд╛ рдЪрд╛рд╣рд┐рдП

## ЁЯФз рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

### Real-time Updates (Firestore Listeners)

```typescript
// Custom hook: src/hooks/useRealtimeUpdates.ts
const realtimeUpdates = useRealtimeUpdates({
  userId: user?.id,
  userRole: 'PARENT',
  studentClass: studentData?.class,
  section: studentData?.section,
  schoolId: user?.schoolId,
  enabled: true
});

// рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВ:
realtimeUpdates.notices      // рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдиреЛрдЯрд┐рд╕
realtimeUpdates.homework      // рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рд╣реЛрдорд╡рд░реНрдХ
realtimeUpdates.messages      // рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдореИрд╕реЗрдЬ
realtimeUpdates.newUpdateCount // рдирдИ рдЪреАрдЬрд╝реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛
```

### Background Notifications (FCM)

1. **рдкрд░рдорд┐рд╢рди рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ:** рдпреВрдЬрд╝рд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкрд░рдорд┐рд╢рди рджреЗрддрд╛ рд╣реИ
2. **рдЯреЛрдХрди рдЬрдирд░реЗрд╢рди:** FCM рдЯреЛрдХрди рдЬрдирд░реЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ Firestore рдореЗрдВ рд╕реЗрд╡ рд╣реЛрддрд╛ рд╣реИ
3. **рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб:** рдЬрдм admin/teacher рдкреЛрд╕реНрдЯ рдХрд░рддрд╛ рд╣реИ, рд╕рд░реНрд╡рд░ FCM рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рднреЗрдЬрддрд╛ рд╣реИ
4. **Service Worker:** рдРрдк рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рднреА рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд░рд┐рд╕реАрд╡ рдХрд░рддрд╛ рд╣реИ
5. **рдпреВрдЬрд╝рд░ рджреЗрдЦрддрд╛ рд╣реИ:** рд╕рд╛рдЙрдВрдб рдФрд░ рд╡рд╛рдЗрдмреНрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди

## ЁЯОп рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯреНрд╕

### VAPID Key рдХрд╣рд╛рдБ рдорд┐рд▓реЗрдЧрд╛?

Firebase Console тЖТ Project Settings тЖТ Cloud Messaging тЖТ Web Push certificates тЖТ Generate key pair

### рдХрд┐рди events рдкрд░ notification рдЬрд╛рдПрдЧрд╛?

1. **Notice:** рдЬрдм admin/teacher рдиреЛрдЯрд┐рд╕ рдкреЛрд╕реНрдЯ рдХрд░реЗ
2. **Homework:** рдЬрдм teacher рд╣реЛрдорд╡рд░реНрдХ assign рдХрд░реЗ
3. **Message:** рдЬрдм рдХреЛрдИ рдореИрд╕реЗрдЬ рднреЗрдЬреЗ

### Notification sound рдХрдм рдмрдЬреЗрдЧрд╛?

- рдЬрдм parent dashboard рдЦреБрд▓рд╛ рд╣реЛ рдФрд░ рдирдпрд╛ рдЕрдкрдбреЗрдЯ рдЖрдП (foreground)
- рдЬрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░/рдРрдк рдмрдВрдж рд╣реЛ рдФрд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдЖрдП (background)

## ЁЯОи рдХрд╕реНрдЯрдорд╛рдЗрдЬреЗрд╢рди

### Notification Sound рдмрджрд▓реЗрдВ

`public/notification.mp3` рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреА рд╕рд╛рдЙрдВрдб рдлрд╛рдЗрд▓ рд╕реЗ рдмрджрд▓реЗрдВред

### "NEW" Badge рдХрд╛ рд░рдВрдЧ рдмрджрд▓реЗрдВ

`src/pages/portals/ParentDashboard.tsx` рдореЗрдВ:

```tsx
<span style={{ 
  background: '#fbbf24',  // рд░рдВрдЧ рдмрджрд▓реЗрдВ
  color: '#78350f',       // рдЯреЗрдХреНрд╕реНрдЯ рд░рдВрдЧ рдмрджрд▓реЗрдВ
}}>NEW</span>
```

## ЁЯРЫ рд╕рдорд╕реНрдпрд╛ рд╕рдорд╛рдзрд╛рди

### Notifications рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ?

1. **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкрд░рдорд┐рд╢рди рдЪреЗрдХ рдХрд░реЗрдВ:**
   - Chrome: `chrome://settings/content/notifications`
   - рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдЬрд╛рдХрд░ notification permission рджреЗрдВ

2. **Service Worker рдЪреЗрдХ рдХрд░реЗрдВ:**
   - DevTools рдЦреЛрд▓реЗрдВ > Application > Service Workers
   - рдЪреЗрдХ рдХрд░реЗрдВ рдХрд┐ `firebase-messaging-sw.js` registered рд╣реИ

3. **Console errors рдЪреЗрдХ рдХрд░реЗрдВ:**
   - Browser console рджреЗрдЦреЗрдВ
   - "Firebase Messaging initialized successfully" рд▓рд┐рдЦрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

4. **VAPID key:**
   - рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ VAPID key рд╕рд╣реА рд╣реИ
   - рдЬрд╝рд░реВрд░рдд рдкрдврд╝рдиреЗ рдкрд░ рдирдИ key рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ

### Sound рдирд╣реАрдВ рдмрдЬ рд░рд╣реА?

1. рдЪреЗрдХ рдХрд░реЗрдВ рдХрд┐ `public/notification.mp3` рдореМрдЬреВрдж рд╣реИ
2. рдСрдбрд┐рдпреЛ рдлрд╛рдЗрд▓ valid рд╣реИ (рдСрдбрд┐рдпреЛ рдкреНрд▓реЗрдпрд░ рдореЗрдВ рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ)
3. рдмреНрд░рд╛рдЙрдЬрд╝рд░ autoplay policy рдЪреЗрдХ рдХрд░реЗрдВ

## ЁЯУК рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реНрдЯреНрд░рдХреНрдЪрд░

### FCM Tokens Collection

```
fcm_tokens/{userId}
  тФЬтФА token: "FCM_TOKEN_STRING"
  тФЬтФА userId: "user123"
  тФЬтФА updatedAt: Timestamp
  тФФтФА platform: "web"
```

## ЁЯФР рд╕реБрд░рдХреНрд╖рд╛

- рдпреВрдЬрд╝рд░ рдХреЗрд╡рд▓ рдЕрдкрдирд╛ FCM рдЯреЛрдХрди рдкрдврд╝/рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ
- рдХреЗрд╡рд▓ admin/teacher рд╣реА рдиреЛрдЯрд┐рд╕/рд╣реЛрдорд╡рд░реНрдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ

## ЁЯОп рдЕрдЧрд▓реЗ рдХрджрдо (Future Enhancements)

1. **Email notifications:** SendGrid/Mailgun рдХреЗ рд╕рд╛рде
2. **SMS notifications:** Twilio рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ
3. **Notification history:** рд╕рднреА рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдХрд╛ рдкреЗрдЬ
4. **Mark as read:** рдкрдврд╝реЗ рд╣реБрдП рдХреЛ track рдХрд░реЗрдВ
5. **Notification preferences:** рдпреВрдЬрд╝рд░ рдХреЛ рдЪреБрдирдиреЗ рджреЗрдВ рдХрд┐ рдХреМрди рд╕реА рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдЪрд╛рд╣рд┐рдП

## ЁЯУЮ рд╕рд╣рд╛рдпрддрд╛

рдХрд┐рд╕реА рднреА рд╕рдорд╕реНрдпрд╛ рдпрд╛ рд╕рд╡рд╛рд▓ рдХреЗ рд▓рд┐рдП, рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдЯреАрдо рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред

---

**рдЖрдЦрд┐рд░реА рдЕрдкрдбреЗрдЯ:** 30 рдЬрдирд╡рд░реА, 2026
**рд╕рдВрд╕реНрдХрд░рдг:** 1.0.0
